name: "Deploy Java Artifacts"
description: "Deploys Java artifacts to Maven Central"

inputs:
  runnerArch:
    description: "Runner architecture (amd64, arm64)"
    required: false
    default: "amd64"
  gpgPassphrase:
    description: "GPG passphrase for signing"
    required: true
  gpgSigningKey:
    description: "GPG signing key"
    required: true
  artifactoryUsername:
    description: "Artifactory Username"
    required: true
  artifactoryAccessToken:
    description: "Artifactory Access Token"
    required: true

runs:
  using: "composite"
  steps:
    - name: Set up JDK
      uses: actions/setup-java@v5
      with:
        java-version: '17'
        distribution: 'temurin'

    - name: Setup JFrog CLI
      uses: jfrog/setup-jfrog-cli@v4
      env:
        JF_URL: https://artifactory.nordix.org/
        JF_ACCESS_TOKEN: ${{ inputs.artifactoryAccessToken }}

    - name: Restore Maven cache
      uses: actions/cache/restore@v4
      with:
        path: ~/.m2/repository
        key: maven-${{ hashFiles('**/pom.xml') }}
        restore-keys: |
          maven-
          
    - name: Install yq
      uses: ./.github/actions/dependencies/install-yq
      with:
        architecture: ${{ inputs.runnerArch }}
        
    - name: Deploy Java artifacts
      shell: bash
      run: make pushtocentral
      env:
        BUILD_REASON: "IndividualCI"
        BRANCH: ${{ github.ref }}
        GPG_PASSPHRASE: ${{ inputs.gpgPassphrase }}
        GPG_SIGNING_KEY: ${{ inputs.gpgSigningKey }}
        ARTIFACTORY_USER: ${{ inputs.artifactoryUsername }}
        JF_ACCESS_TOKEN: ${{ inputs.artifactoryAccessToken }}